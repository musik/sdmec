# -*- encoding : utf-8 -*-
Tb::Application.routes.draw do

  resources :huatis,:path=>"topics" do
    collection do
      get 'manage'
      get 'popular'
      get 'search'
      get 'auto_complete'
    end
    member do
      post 'visit'
      post 'fetch'
    end
  end
  match 'browse/other/:acr'=>'huatis#browse',:as=>'browse_huatis'

  resources :cats do
    collection do
      get 'manage'
      get 'tree'
    end
  end

  resources :links

  match '/to/:id' => 'topics#go',:as=>'go',:constraints=>{:id=>/[\w\d\.\_\%\-]+/}
  constraints(Subdomain) do
    match '/t/:id'=>'city/home#page',:as=>'page'
    match '/mai/auto_complete'=>'topics#auto_complete',:as=>'topics_auto_complete'
    # match '/city/visit'=>'city/topics#city_visit'
    # match '/mai/search'=>'city/topics#search',:as=>'topics_search'
    resources :topics,:path=>'mai',:controller=>'city/topics' do
      member do
        get 'page/:page', :action => :show
      end
      collection do
        get 'page/:page', :action => :index
        get 'search'
        post 'city_visit'
        get 'popular'
      end
    end
    # match 'mai(/page/:page)'=>'city/topics#index',:as=>'topics'
    # match 'mai/:id(/page/:page)'=>'city/topics#show',:as=>'topic'
    match 'start/:i(/page/:page)'=>'city/topics#browse',:as=>'browse_topics'
    root :to => 'city/home#index'
  end
  match '/t/:id'=>'home#page',:as=>'page'
  match '/link/:nid'=>"items#go",:as=>'item_go'
  match '/ad/:id'=>'home#ad',:as=>'ad'
  resources :tbpages
  resources :cities,:only=>"index"
  resources :categories#,:only=>"index"
  match "syncs/:type/new" => "syncs#new", :as => :sync_new
  match "syncs/:type/callback" => "syncs#callback", :as => :sync_callback
  resources :topics,:path=>'mai' do
    member do
      get 'page/:page', :action => :show
      post 'visit'
      get 'publish'
    end
    collection do
      get 'page/:page', :action => :index
      get 'auto_complete'
      get 'search'
      get 'popular'
      get 'manage'
    end
  end

  match 'start/:i(/page/:page)'=>'topics#browse',:as=>'browse_topics'


  # authenticated :user do
    # root :to => 'topics#index'
  # end

  root :to => "home#index"
  match '/flush' => 'home#flush',:as=>'flush'
  devise_for :users
  resources :users, :only => [:show, :index]
end
