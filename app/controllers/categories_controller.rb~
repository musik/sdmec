# -*- encoding : utf-8 -*-
class CategoriesController < ApplicationController
  load_resource
  authorize_resource :except=>[]
  def index
    params[:page] ||= 1
    @categories = Category.page(params[:page]).per(160)
    breadcrumbs.add :topics, nil,:class=>'active'
  end

  def show
    @city = Subdomain.matches?(request) ? City.find_by_slug(request.subdomain) : nil

    @items = @category.items.page(params[:page] || 1).per(40)
    @title = @city.present? ? "#{@city.name} #{@category.name}" : @category.name

    unless @category.root?
      breadcrumbs.add @category.parent_name,url_for(@category.parent)
    end
    breadcrumbs.add @category.name,nil
  end

  def new
    @topic = Topic.new
  end

  def create
    @topic = Topic.new(params[:topic])
    if @topic.save
      redirect_to @topic, :notice => "Successfully created topic."
    else
      render :action => 'new'
    end
  end

  def edit
  end

  def update
    if @topic.update_attributes(params[:topic])
      redirect_to @topic, :notice  => "Successfully updated topic."
    else
      render :action => 'edit'
    end
  end

  def destroy
    @topic.destroy
    redirect_to topics_url, :notice => "Successfully destroyed topic."
  end

  def go
    url = params[:id].reverse
    redirect_to url
  end
end
