# -*- encoding : utf-8 -*-
class HomeController < ApplicationController
  caches_action :page,
      :expires_in => 8.hour,
      :cache_path => Proc.new { |c| c.params }
  def index
    # @items = Tbpage.all_items
    @items = Item.order("commission_volume desc").limit(40)
    @cities = City.cached_roots
    #@hide_whole = true
  end
  def page
    @page = Tbpage.find_by_slug params[:id]
    @items = @page.items

    breadcrumbs.add @page.name,nil
  end
  def item_go
    @item = Item.find_by_num_iid params[:nid]
    redirect_to @item.click_url
  end
  def ad
    params[:num] ||= 4
    params[:num] = params[:num].to_i if params[:num].is_a? String
    @cid = params[:id]

    @ad = Ad.new @cid
    @items = @ad.items#.slice(0,params[:num])

    if request.xhr? or params[:ajax]
      render :layout=>false
    end
    # render :json=>@ad.items
  end
  def flush
    expire_action :action=>'index'
    redirect_to :action=>'index'
  end
end
